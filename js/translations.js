// Translation Manager
class TranslationManager {
  constructor() {
    this.translations = {
      es: {
        appTitle: "Cocina para Uno",
        appSubtitle: "Tu recetario personal dinámico",
        searchPlaceholder: "Buscar recetas o ingredientes...",
        newRecipe: "Nueva Receta",
        favorites: "Favoritos",
        allCategories: "Todas las categorías",
        cookingTime: "Tiempo",
        servings: "Porciones",
        difficulty: "Dificultad",
        ingredients: "Ingredientes",
        steps: "Pasos",
        rating: "Calificación",
        manualRating: "Tu Calificación",
        autoRating: "Popularidad",
        finalRating: "Calificación Final",
        save: "Guardar",
        cancel: "Cancelar",
        edit: "Editar",
        delete: "Eliminar",
        view: "Ver",
        addRecipe: "Agregar Receta",
        editRecipe: "Editar Receta",
        recipeName: "Nombre de la receta",
        addIngredient: "Agregar ingrediente",
        addStep: "Agregar paso",
        selectCategory: "Seleccionar categoría",
        selectDifficulty: "Seleccionar dificultad",
        minutes: "minutos",
        easy: "Fácil",
        medium: "Medio",
        hard: "Difícil",
        noRecipes: "No hay recetas disponibles",
        noRecipesDesc: "Crea tu primera receta",
        createFirst: "Crea tu primera receta",
        footer: "Hecho con ❤️ para cocineros solitarios",
        deleteConfirm: "¿Estás seguro de eliminar esta receta?",
        recipeAdded: "Receta agregada exitosamente",
        recipeUpdated: "Receta actualizada exitosamente",
        recipeDeleted: "Receta eliminada exitosamente",
        statistics: "Estadísticas",
        totalRecipes: "Total de recetas",
        favoriteRecipes: "Favoritas",
        averageTime: "Tiempo promedio",
        technology: "Tecnología",
        loadingImage: "Cargando imagen...",
        notes: "Notas Personales",
        addNotes: "Agregar notas...",
        timesCooked: "Veces cocinada",
        lastCooked: "Última vez",
        markAsCooked: "Marcar como Cocinada",
        never: "Nunca",
        today: "Hoy",
        yesterday: "Ayer",
        daysAgo: "hace {days} días",
        rateRecipe: "Califica esta receta",
        cookingStats: "Estadísticas de Cocción",
        categoryNames: {
          Desayuno: "Desayuno",
          Almuerzo: "Almuerzo",
          Cena: "Cena",
          Postre: "Postre",
          Snack: "Snack",
          Vegetariano: "Vegetariano",
          Vegano: "Vegano",
          "Sin Gluten": "Sin Gluten",
          Rápido: "Rápido",
          Saludable: "Saludable",
        },
        unfavorite: "Quitar de favoritos",
        favorite: "Marcar como favorito",
        exportRecipe: "Exportar Receta",
        selectFormat: "Selecciona el formato de exportación:",
        pdfDesc: "Documento profesional",
        jsonDesc: "Datos estructurados",
        csvDesc: "Excel compatible",
        txtDesc: "Texto plano",
        markdownDesc: "Formato web",
        cardDesc: "Imagen PNG",
        exportOptions: "Opciones de Exportación",
        includeImage: "Incluir imagen",
        includeStats: "Incluir estadísticas",
        includeNotes: "Incluir notas",
        includeHistory: "Incluir historial de cocción",
        exportSuccess: "Receta exportada exitosamente",
        exportError: "Error al exportar",
        unsupportedFormat: "Formato no soportado",
        generatedBy: "Generado por",
        page: "Página",
        of: "de",
        basicInfo: "Información Básica",
        cookedOn: "Cocinada el",
        totalCooked: "Total cocinado",
        allRightsReserved: "Todos los derechos reservados.",
        madeWith: "Hecho con ❤️ para cocineros solitarios",
      },
      en: {
        appTitle: "One Cooking",
        appSubtitle: "Your dynamic personal recipe book",
        searchPlaceholder: "Search recipes or ingredients...",
        newRecipe: "New Recipe",
        favorites: "Favorites",
        allCategories: "All Categories",
        cookingTime: "Time",
        servings: "Servings",
        difficulty: "Difficulty",
        ingredients: "Ingredients",
        steps: "Steps",
        rating: "Rating",
        manualRating: "Your Rating",
        autoRating: "Popularity",
        finalRating: "Final Rating",
        save: "Save",
        cancel: "Cancel",
        edit: "Edit",
        delete: "Delete",
        view: "View",
        addRecipe: "Add Recipe",
        editRecipe: "Edit Recipe",
        recipeName: "Recipe name",
        addIngredient: "Add ingredient",
        addStep: "Add step",
        selectCategory: "Select category",
        selectDifficulty: "Select difficulty",
        minutes: "minutes",
        easy: "Easy",
        medium: "Medium",
        hard: "Hard",
        noRecipes: "No recipes available",
        noRecipesDesc: "Create your first delicious recipe!",
        createFirst: "Create my first recipe",
        footer: "Made with ❤️ for solo cooks",
        deleteConfirm: "Are you sure you want to delete this recipe?",
        recipeAdded: "Recipe added successfully",
        recipeUpdated: "Recipe updated successfully",
        recipeDeleted: "Recipe deleted successfully",
        statistics: "Statistics",
        totalRecipes: "Total recipes",
        favoriteRecipes: "Favorites",
        averageTime: "Average time",
        technology: "Technology",
        loadingImage: "Loading image...",
        notes: "Personal Notes",
        addNotes: "Add notes...",
        timesCooked: "Times cooked",
        lastCooked: "Last cooked",
        markAsCooked: "Mark as Cooked",
        never: "Never",
        today: "Today",
        yesterday: "Yesterday",
        daysAgo: "{days} days ago",
        rateRecipe: "Rate this recipe",
        cookingStats: "Cooking Statistics",
        categoryNames: {
          Desayuno: "Breakfast",
          Almuerzo: "Lunch",
          Cena: "Dinner",
          Postre: "Dessert",
          Snack: "Snack",
          Vegetariano: "Vegetarian",
          Vegano: "Vegan",
          "Sin Gluten": "Gluten Free",
          Rápido: "Quick",
          Saludable: "Healthy",
        },
        unfavorite: "Unfavorite",
        favorite: "Mark as favorite",
        exportRecipe: "Export Recipe",
        selectFormat: "Select export format:",
        pdfDesc: "Professional document",
        jsonDesc: "Structured data",
        csvDesc: "Excel compatible",
        txtDesc: "Plain text",
        markdownDesc: "Web format",
        cardDesc: "PNG image",
        exportOptions: "Export Options",
        includeImage: "Include image",
        includeStats: "Include statistics",
        includeNotes: "Include notes",
        includeHistory: "Include cooking history",
        exportSuccess: "Recipe exported successfully",
        exportError: "Error exporting",
        unsupportedFormat: "Unsupported format",
        generatedBy: "Generated by",
        page: "Page",
        of: "of",
        basicInfo: "Basic Information",
        cookedOn: "Cooked on",
        totalCooked: "Total cooked",
        allRightsReserved: "All rights reserved.",
        madeWith: "Made with ❤️ for solo cooks",
      },
      fr: {
        appTitle: "Cuisine pour Un",
        appSubtitle: "Votre livre de recettes personnel dynamique",
        searchPlaceholder: "Rechercher des recettes ou des ingrédients...",
        newRecipe: "Nouvelle Recette",
        favorites: "Favoris",
        allCategories: "Toutes les catégories",
        cookingTime: "Temps",
        servings: "Portions",
        difficulty: "Difficulté",
        ingredients: "Ingrédients",
        steps: "Étapes",
        rating: "Note",
        manualRating: "Votre Note",
        autoRating: "Popularité",
        finalRating: "Note Finale",
        save: "Sauvegarder",
        cancel: "Annuler",
        edit: "Modifier",
        delete: "Supprimer",
        view: "Voir",
        addRecipe: "Ajouter une Recette",
        editRecipe: "Modifier la Recette",
        recipeName: "Nom de la recette",
        addIngredient: "Ajouter un ingrédient",
        addStep: "Ajouter une étape",
        selectCategory: "Sélectionner une catégorie",
        selectDifficulty: "Sélectionner la difficulté",
        minutes: "minutes",
        easy: "Facile",
        medium: "Moyen",
        hard: "Difficile",
        noRecipes: "Aucune recette disponible",
        noRecipesDesc: "Créez votre première recette délicieuse !",
        createFirst: "Créez ma première recette",
        footer: "Fait avec ❤️ pour les cuisiniers solitaires",
        deleteConfirm: "Êtes-vous sûr de supprimer cette recette?",
        recipeAdded: "Recette ajoutée avec succès",
        recipeUpdated: "Recette mise à jour avec succès",
        recipeDeleted: "Recette supprimée avec succès",
        statistics: "Statistiques",
        totalRecipes: "Total des recettes",
        favoriteRecipes: "Favoris",
        averageTime: "Temps moyen",
        technology: "Technologie",
        loadingImage: "Chargement de l'image...",
        notes: "Notes Personnelles",
        addNotes: "Ajouter des notes...",
        timesCooked: "Fois cuisinée",
        lastCooked: "Dernière fois",
        markAsCooked: "Marquer comme Cuisinée",
        never: "Jamais",
        today: "Aujourd'hui",
        yesterday: "Hier",
        daysAgo: "il y a {days} jours",
        rateRecipe: "Noter cette recette",
        cookingStats: "Statistiques de Cuisine",
        categoryNames: {
          Desayuno: "Petit-déjeuner",
          Almuerzo: "Déjeuner",
          Cena: "Dîner",
          Postre: "Dessert",
          Snack: "Collation",
          Vegetariano: "Végétarien",
          Vegano: "Végétalien",
          "Sin Gluten": "Sans Gluten",
          Rápido: "Rapide",
          Saludable: "Sain",
        },
        unfavorite: "Retirer des favoris",
        favorite: "Marquer comme favori",
        exportRecipe: "Exporter la Recette",
        selectFormat: "Sélectionnez le format d'exportation :",
        pdfDesc: "Document professionnel",
        jsonDesc: "Données structurées",
        csvDesc: "Compatible Excel",
        txtDesc: "Texte brut",
        markdownDesc: "Format web",
        cardDesc: "Image PNG",
        exportOptions: "Options d'Exportation",
        includeImage: "Inclure l'image",
        includeStats: "Inclure les statistiques",
        includeNotes: "Inclure les notes",
        includeHistory: "Inclure l'historique de cuisson",
        exportSuccess: "Recette exportée avec succès",
        exportError: "Erreur d'exportation",
        unsupportedFormat: "Format non supporté",
        generatedBy: "Généré par",
        page: "Page",
        of: "de",
        basicInfo: "Informations de base",
        cookedOn: "Cuisiné le",
        totalCooked: "Total cuisiné",
        allRightsReserved: "Tous droits réservés.",
        madeWith: "Fait avec ❤️ pour les cuisiniers solitaires",
      },
      pt: {
        appTitle: "Cozinha para Um",
        appSubtitle: "Seu livro de receitas pessoal dinâmico",
        searchPlaceholder: "Buscar receitas ou ingredientes...",
        newRecipe: "Nova Receita",
        favorites: "Favoritos",
        allCategories: "Todas as Categorias",
        cookingTime: "Tempo",
        servings: "Porções",
        difficulty: "Dificuldade",
        ingredients: "Ingredientes",
        steps: "Passos",
        rating: "Avaliação",
        manualRating: "Sua Avaliação",
        autoRating: "Popularidade",
        finalRating: "Avaliação Final",
        save: "Salvar",
        cancel: "Cancelar",
        edit: "Editar",
        delete: "Excluir",
        view: "Ver",
        addRecipe: "Adicionar Receita",
        editRecipe: "Editar Receita",
        recipeName: "Nome da receita",
        addIngredient: "Adicionar ingrediente",
        addStep: "Adicionar passo",
        selectCategory: "Selecionar categoria",
        selectDifficulty: "Selecionar dificuldade",
        minutes: "minutos",
        easy: "Fácil",
        medium: "Médio",
        hard: "Difícil",
        noRecipes: "Nenhuma receita disponível",
        noRecipesDesc: "Crie sua primeira receita deliciosa!",
        createFirst: "Crie minha primeira receita",
        footer: "Feito com ❤️ para cozinheiros solitários",
        deleteConfirm: "Tem certeza de que deseja excluir esta receita?",
        recipeAdded: "Receita adicionada com sucesso",
        recipeUpdated: "Receita atualizada com sucesso",
        recipeDeleted: "Receita excluída com sucesso",
        statistics: "Estatísticas",
        totalRecipes: "Total de receitas",
        favoriteRecipes: "Favoritas",
        averageTime: "Tempo médio",
        technology: "Tecnologia",
        loadingImage: "Carregando imagem...",
        notes: "Notas Pessoais",
        addNotes: "Adicionar notas...",
        timesCooked: "Vezes cozinhada",
        lastCooked: "Última vez",
        markAsCooked: "Marcar como Cozinhada",
        never: "Nunca",
        today: "Hoje",
        yesterday: "Ontem",
        daysAgo: "há {days} dias",
        rateRecipe: "Avaliar esta receita",
        cookingStats: "Estatísticas de Cozinha",
        categoryNames: {
          Desayuno: "Café da manhã",
          Almuerzo: "Almoço",
          Cena: "Jantar",
          Postre: "Sobremesa",
          Snack: "Lanche",
          Vegetariano: "Vegetariano",
          Vegano: "Vegano",
          "Sin Gluten": "Sem Glúten",
          Rápido: "Rápido",
          Saludable: "Saudável",
        },
        unfavorite: "Remover dos favoritos",
        favorite: "Marcar como favorito",
        exportRecipe: "Exportar Receita",
        selectFormat: "Selecione o formato de exportação:",
        pdfDesc: "Documento profissional",
        jsonDesc: "Dados estruturados",
        csvDesc: "Compatível com Excel",
        txtDesc: "Texto simples",
        markdownDesc: "Formato web",
        cardDesc: "Imagem PNG",
        exportOptions: "Opções de Exportação",
        includeImage: "Incluir imagem",
        includeStats: "Incluir estatísticas",
        includeNotes: "Incluir notas",
        includeHistory: "Incluir histórico de cozimento",
        exportSuccess: "Receita exportada com sucesso",
        exportError: "Erro ao exportar",
        unsupportedFormat: "Formato não suportado",
        generatedBy: "Gerado por",
        page: "Página",
        of: "de",
        basicInfo: "Informações Básicas",
        cookedOn: "Cozinhado em",
        totalCooked: "Total cozinhado",
        allRightsReserved: "Todos os direitos reservados.",
        madeWith: "Feito com ❤️ para cozinheiros solitários",
      },
      it: {
        appTitle: "Cucina per Uno",
        appSubtitle: "Il tuo libro di ricette personale dinamico",
        searchPlaceholder: "Cerca ricette o ingredienti...",
        newRecipe: "Nuova Ricetta",
        favorites: "Preferiti",
        allCategories: "Tutte le Categorie",
        cookingTime: "Tempo",
        servings: "Porzioni",
        difficulty: "Difficoltà",
        ingredients: "Ingredienti",
        steps: "Passaggi",
        rating: "Valutazione",
        manualRating: "La Tua Valutazione",
        autoRating: "Popolarità",
        finalRating: "Valutazione Finale",
        save: "Salva",
        cancel: "Annulla",
        edit: "Modifica",
        delete: "Elimina",
        view: "Visualizza",
        addRecipe: "Aggiungi Ricetta",
        editRecipe: "Modifica Ricetta",
        recipeName: "Nome della ricetta",
        addIngredient: "Aggiungi ingrediente",
        addStep: "Aggiungi passaggio",
        selectCategory: "Seleziona categoria",
        selectDifficulty: "Seleziona difficoltà",
        minutes: "minuti",
        easy: "Facile",
        medium: "Medio",
        hard: "Difficile",
        noRecipes: "Nessuna ricetta disponibile",
        noRecipesDesc: "Crea la tua prima deliziosa ricetta!",
        createFirst: "Crea la mia prima ricetta",
        footer: "Fatto con ❤️ per cuochi solitari",
        deleteConfirm: "Sei sicuro di voler eliminare questa ricetta?",
        recipeAdded: "Ricetta aggiunta con successo",
        recipeUpdated: "Ricetta aggiornata con successo",
        recipeDeleted: "Ricetta eliminata con successo",
        statistics: "Statistiche",
        totalRecipes: "Totale ricette",
        favoriteRecipes: "Preferite",
        averageTime: "Tempo medio",
        technology: "Tecnologia",
        loadingImage: "Caricamento immagine...",
        notes: "Note Personali",
        addNotes: "Aggiungi note...",
        timesCooked: "Volte cucinata",
        lastCooked: "Ultima volta",
        markAsCooked: "Segna come Cucinata",
        never: "Mai",
        today: "Oggi",
        yesterday: "Ieri",
        daysAgo: "{days} giorni fa",
        rateRecipe: "Valuta questa ricetta",
        cookingStats: "Statistiche di Cucina",
        categoryNames: {
          Desayuno: "Colazione",
          Almuerzo: "Pranzo",
          Cena: "Cena",
          Postre: "Dolce",
          Snack: "Spuntino",
          Vegetariano: "Vegetariano",
          Vegano: "Vegano",
          "Sin Gluten": "Senza Glutine",
          Rápido: "Veloce",
          Saludable: "Salutare",
        },
        unfavorite: "Rimuovi dai preferiti",
        favorite: "Segna come preferito",
        exportRecipe: "Esporta Ricetta",
        selectFormat: "Seleziona il formato di esportazione:",
        pdfDesc: "Documento professionale",
        jsonDesc: "Dati strutturati",
        csvDesc: "Compatibile Excel",
        txtDesc: "Testo semplice",
        markdownDesc: "Formato web",
        cardDesc: "Immagine PNG",
        exportOptions: "Opzioni di Esportazione",
        includeImage: "Includi immagine",
        includeStats: "Includi statistiche",
        includeNotes: "Includi note",
        includeHistory: "Includi cronologia di cottura",
        exportSuccess: "Ricetta esportata con successo",
        exportError: "Errore durante l'esportazione",
        unsupportedFormat: "Formato non supportato",
        generatedBy: "Generato da",
        page: "Pagina",
        of: "di",
        basicInfo: "Informazioni di base",
        cookedOn: "Cucinato il",
        totalCooked: "Totale cucinato",
        allRightsReserved: "Tutti i diritti riservati.",
        madeWith: "Fatto con ❤️ per cuochi solitari",
      },
    }
    this.currentLanguage = localStorage.getItem("language") || "es"
    this.setLanguage(this.currentLanguage)
  }

  setLanguage(lang) {
    if (this.translations[lang]) {
      this.currentLanguage = lang
      localStorage.setItem("language", lang)
      this.updateUI()
    } else {
      console.warn(`Language ${lang} not supported. Falling back to Spanish.`)
      this.currentLanguage = "es"
      localStorage.setItem("language", "es")
      this.updateUI()
    }
  }

  get(key) {
    const keys = key.split(".")
    let result = this.translations[this.currentLanguage]
    for (const k of keys) {
      if (result && typeof result === "object" && k in result) {
        result = result[k]
      } else {
        return key // Fallback to key if translation not found
      }
    }
    return result
  }

  updateUI() {
    document.querySelectorAll("[data-translate]").forEach((element) => {
      const key = element.getAttribute("data-translate")
      if (key) {
        element.textContent = this.get(key)
      }
    })
    document.querySelectorAll("[data-translate-placeholder]").forEach((element) => {
      const key = element.getAttribute("data-translate-placeholder")
      if (key) {
        element.placeholder = this.get(key)
      }
    })
    document.getElementById("current-language").textContent = this.currentLanguage.toUpperCase()

    // Update category filter options
    const categoryFilter = document.getElementById("category-filter")
    if (categoryFilter) {
      const selectedValue = categoryFilter.value
      categoryFilter.innerHTML = `<option value="all" data-translate="allCategories">${this.get("allCategories")}</option>`
      const categories = [
        "Desayuno",
        "Almuerzo",
        "Cena",
        "Postre",
        "Snack",
        "Vegetariano",
        "Vegano",
        "Sin Gluten",
        "Rápido",
        "Saludable",
      ]
      categories.forEach((cat) => {
        const option = document.createElement("option")
        option.value = cat
        option.textContent = this.get(`categoryNames.${cat}`) || cat
        categoryFilter.appendChild(option)
      })
      categoryFilter.value = selectedValue // Restore selected value
    }
  }

  cycleLanguage() {
    const languages = ["es", "en", "fr", "pt", "it"]
    const currentIndex = languages.indexOf(this.currentLanguage)
    const nextIndex = (currentIndex + 1) % languages.length
    this.setLanguage(languages[nextIndex])
  }
}

window.TranslationManager = TranslationManager
